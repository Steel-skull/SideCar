<div class="sidecar-lore-settings">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b>Sidecar Lore</b>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">
            <!-- Main Enable Toggle -->
            <div class="sidecar-setting-row">
                <label class="checkbox_label" for="sidecar-enabled">
                    <input type="checkbox" id="sidecar-enabled" />
                    <span>Enable Sidecar Lore</span>
                </label>
                <div class="sidecar-setting-hint">Master toggle for the extension</div>
            </div>

            <hr class="sidecar-divider" />

            <!-- Automatic Updates Section -->
            <h4 class="sidecar-section-header">Automatic Updates</h4>

            <div class="sidecar-setting-row">
                <label class="checkbox_label" for="sidecar-auto-update">
                    <input type="checkbox" id="sidecar-auto-update" />
                    <span>Auto-update on messages</span>
                </label>
                <div class="sidecar-setting-hint">Automatically analyze chat for state changes</div>
            </div>

            <div class="sidecar-setting-row">
                <label for="sidecar-update-frequency">Update every N messages</label>
                <input type="number" id="sidecar-update-frequency" min="1" max="50" value="1" class="text_pole" />
                <div class="sidecar-setting-hint">How often to run analysis (1 = every message)</div>
            </div>

            <div class="sidecar-setting-row">
                <label for="sidecar-history-depth">Messages to analyze</label>
                <input type="number" id="sidecar-history-depth" min="5" max="100" value="25" class="text_pole" />
                <div class="sidecar-setting-hint">Number of recent messages sent to the analyzer</div>
            </div>

            <div class="sidecar-setting-row">
                <label class="checkbox_label" for="sidecar-show-popup">
                    <input type="checkbox" id="sidecar-show-popup" />
                    <span>Show approval popup</span>
                </label>
                <div class="sidecar-setting-hint">Review changes before applying (recommended)</div>
            </div>

            <hr class="sidecar-divider" />

            <!-- Context Injection Section -->
            <h4 class="sidecar-section-header">Context Injection</h4>

            <div class="sidecar-setting-row">
                <label class="checkbox_label" for="sidecar-inject-context">
                    <input type="checkbox" id="sidecar-inject-context" />
                    <span>Inject sidecar into prompts</span>
                </label>
                <div class="sidecar-setting-hint">Add character state to LLM prompts</div>
            </div>

            <div class="sidecar-setting-row">
                <label for="sidecar-inject-position">Injection position</label>
                <select id="sidecar-inject-position" class="text_pole">
                    <option value="system">System prompt area</option>
                    <option value="author_note">Before last message</option>
                    <option value="character_note">After character card</option>
                </select>
                <div class="sidecar-setting-hint">Where to insert the sidecar context</div>
            </div>

            <hr class="sidecar-divider" />

            <!-- Model Selection Section -->
            <h4 class="sidecar-section-header">Model Selection</h4>

            <div class="sidecar-setting-row">
                <label for="sidecar-cheap-profile">Updater Profile (Cheap/Fast)</label>
                <select id="sidecar-cheap-profile" class="text_pole">
                    <option value="">-- Current Profile --</option>
                    <!-- Populated dynamically -->
                </select>
            </div>
            <div class="sidecar-setting-row">
                <label for="sidecar-cheap-preset">Updater Preset</label>
                <select id="sidecar-cheap-preset" class="text_pole">
                    <option value="">-- Current Preset --</option>
                    <!-- Populated dynamically -->
                </select>
                <div class="sidecar-setting-hint">Model for frequent state updates</div>
            </div>

            <div class="sidecar-setting-row">
                <label for="sidecar-architect-profile">Architect Profile (Smart)</label>
                <select id="sidecar-architect-profile" class="text_pole">
                    <option value="">-- Current Profile --</option>
                    <!-- Populated dynamically -->
                </select>
            </div>
            <div class="sidecar-setting-row">
                <label for="sidecar-architect-preset">Architect Preset</label>
                <select id="sidecar-architect-preset" class="text_pole">
                    <option value="">-- Current Preset --</option>
                    <!-- Populated dynamically -->
                </select>
                <div class="sidecar-setting-hint">Model for schema design and complex analysis</div>
            </div>

            <hr class="sidecar-divider" />

            <!-- NPC Tracking Section -->
            <h4 class="sidecar-section-header">NPC Tracking</h4>

            <div class="sidecar-setting-row">
                <label class="checkbox_label" for="sidecar-npc-enabled">
                    <input type="checkbox" id="sidecar-npc-enabled" />
                    <span>Enable NPC tracking</span>
                </label>
                <div class="sidecar-setting-hint">Detect and track NPCs with individual sidecars</div>
            </div>

            <div class="sidecar-setting-row">
                <label class="checkbox_label" for="sidecar-npc-auto-classify">
                    <input type="checkbox" id="sidecar-npc-auto-classify" />
                    <span>Auto-classify NPCs</span>
                </label>
                <div class="sidecar-setting-hint">Let the LLM promote/demote NPCs based on story importance</div>
            </div>

            <div class="sidecar-setting-row">
                <label for="sidecar-npc-max-major">Max major NPCs</label>
                <input type="number" id="sidecar-npc-max-major" min="1" max="20" value="5" class="text_pole" />
                <div class="sidecar-setting-hint">Maximum number of major NPCs (full tracking)</div>
            </div>

            <div class="sidecar-setting-row">
                <label for="sidecar-npc-inject-depth">NPC context depth</label>
                <select id="sidecar-npc-inject-depth" class="text_pole">
                    <option value="none">None - Don't inject NPC context</option>
                    <option value="minimal">Minimal - Active scene NPCs only</option>
                    <option value="moderate">Moderate - Recent NPCs with summary</option>
                    <option value="full">Full - All tracked NPCs</option>
                </select>
                <div class="sidecar-setting-hint">How much NPC data to inject into prompts</div>
            </div>

            <div class="sidecar-setting-row">
                <label for="sidecar-npc-promotion-threshold">Promotion threshold</label>
                <input type="number" id="sidecar-npc-promotion-threshold" min="1" max="20" value="3" class="text_pole" />
                <div class="sidecar-setting-hint">Appearances before a minor NPC may be promoted</div>
            </div>

            <div class="sidecar-button-row" style="margin-top: 10px;">
                <button id="sidecar-analyze-npcs" class="menu_button">
                    <i class="fa-solid fa-user-magnifying-glass"></i>
                    Analyze NPCs
                </button>
                <button id="sidecar-view-npc-registry" class="menu_button">
                    <i class="fa-solid fa-users"></i>
                    View Registry
                </button>
            </div>
            <div class="sidecar-setting-hint" style="text-align: center; margin-top: 5px;">
                Analyze: Update NPC states | Registry: View all tracked NPCs
            </div>

            <hr class="sidecar-divider" />

            <!-- Manual Actions -->
            <h4 class="sidecar-section-header">Manual Actions</h4>

            <div class="sidecar-button-row">
                <button id="sidecar-trigger-analysis" class="menu_button">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    Analyze Now
                </button>
                <button id="sidecar-trigger-architect" class="menu_button">
                    <i class="fa-solid fa-wand-magic-sparkles"></i>
                    Architect Mode
                </button>
                <button id="sidecar-view-panel" class="menu_button">
                    <i class="fa-solid fa-id-card"></i>
                    Character Sheet
                </button>
            </div>

            <div class="sidecar-setting-hint" style="text-align: center; margin-top: 5px;">
                Analyze: Run update check | Architect: Suggest new trackers | Sheet: View/Edit data
            </div>

            <hr class="sidecar-divider" />

            <!-- Advanced -->
            <h4 class="sidecar-section-header">Advanced</h4>
            
            <div class="sidecar-button-row">
                <button id="sidecar-cleanup-messages" class="menu_button" style="background-color: #b8860b;">
                    <i class="fa-solid fa-broom"></i>
                    Cleanup Sidecar Messages
                </button>
            </div>
            <div class="sidecar-setting-hint" style="text-align: center; margin-top: 5px;">
                Remove any visible sidecar messages from chat history
            </div>
            
            <div class="sidecar-button-row" style="margin-top: 10px;">
                <button id="sidecar-reset-settings" class="menu_button" style="background-color: #8b0000;">
                    <i class="fa-solid fa-trash-can"></i>
                    Reset Settings
                </button>
            </div>
            <div class="sidecar-setting-hint" style="text-align: center; margin-top: 5px;">
                Reset all Sidecar settings to defaults (requires page reload)
            </div>
        </div>
    </div>
</div>